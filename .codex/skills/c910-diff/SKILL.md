---
name: c910-diff
description: Compare the latest C910 coremark ref vs wolf logs, decide whether outputs are equivalent, and iteratively instrument RTL and rerun make run_c910_diff to find wolf-sv-parser introduced mismatches. Use when investigating mismatches between build/logs/c910/c910_ref_coremark_*.log and build/logs/c910/c910_wolf_coremark_*.log or when run_c910_diff results are not equivalent.
---

# C910 Diff

## Overview

Guide a repeatable diff workflow for C910 coremark runs: always start by generating fresh logs, judge equivalence, and iteratively instrument non-generated RTL to isolate wolf-sv-parser introduced mismatches. Maintain a running report under docs/c910 and converge to the smallest faulty module.

## Workflow

### 0) Always start with a fresh run

From repo root, run this first on every investigation and before each new major iteration:

```bash
make run_c910_diff -j
```

This ensures log paths and instrumentation reflect the current state.

### 1) Collect the latest logs

- Find the newest ref and wolf logs by mtime:

```bash
ls -t build/logs/c910/c910_ref_coremark_*.log | head -1
ls -t build/logs/c910/c910_wolf_coremark_*.log | head -1
```

Record the log paths in the report (they should be from the fresh run in step 0).

### 2) Decide equivalence

- Scan for errors or warnings first:

```bash
rg -n "ERROR|FATAL|ASSERT|WARNING" <ref_log>
rg -n "ERROR|FATAL|ASSERT|WARNING" <wolf_log>
```

- Compare key CoreMark output lines (cycles, iterations, score, size):

```bash
rg -n "VCUNT_SIM|CoreMark" <ref_log>
rg -n "VCUNT_SIM|CoreMark" <wolf_log>
```

- Run a full diff. If needed, filter only known nondeterministic lines (timestamps, absolute paths, build metadata) and document any filters used:

```bash
diff -u <ref_log> <wolf_log>
```

Treat the logs as equivalent only when functional output matches (CoreMark results and error/warn presence) and any remaining differences are clearly nondeterministic.

### 3) If equivalent, document and stop

Record the equivalence decision and evidence in the report, then stop. Do not invent further work.

### 4) If not equivalent, form hypotheses

Use C910 domain knowledge to list likely sources before instrumenting. Examples:

- Reset, clock gating, or power-up sequencing differences
- CSR or interrupt behavior (pending/enable/ack)
- Cache or memory ordering effects
- Uninitialized or X-propagated signals
- Width/sign mismatches or truncation during emit

Keep hypotheses short and traceable to candidate modules/signals.

### 5) Instrument non-generated RTL

- Edit only non-generated sources under:
  - tests/data/openc910/C910_RTL_FACTORY
  - tests/data/openc910/smart_run
- Avoid files under build outputs (e.g., work/, work_ref/, work_wolf/) and any file with headers like "Generated by" or "DO NOT EDIT". Prefer modules in logical/ or gen_rtl/ that are not auto-generated.
- Keep instrumentation minimal and reversible. For this workflow, it is OK to add direct prints without macro guards; the user will clean them up later via version control.
- On each iteration, remove or rollback probes that have already been ruled out to keep output concise and reduce noise. Keep only the smallest set of active probes that directly test the current hypothesis.
- If you do add a guard, enable it via the smart_run build flags (for example, add +define+WOLF_C910_DIFF to SIMULATOR_DEF or VERILATOR_FLAGS) and apply it to both ref and wolf runs for comparable output.
- You may read `tests/data/openc910/smart_run/work_wolf/wolf_emit/sim_top_wolf.sv` to understand the latest wolf-sv-parser output, but do not instrument or edit that generated file.

### 6) Re-run and capture new logs

From repo root (repeat step 0 whenever instrumentation changes):

```bash
make run_c910_diff -j
```

Capture the new log paths and include them in the report.

### 7) Analyze and iterate

- Diff the new logs and use the added instrumentation to narrow the root cause.
- If the root cause is still unclear, repeat steps 4-7. Each iteration must be documented.
- Each iteration should reduce output volume and tighten scope, progressively zooming in on the failing block or signal.
- Allow multiple phase-level notes per run (e.g., "phase: log triage", "phase: probe A/B", "phase: narrowed to module X") before moving to the next iteration.

## Report requirements

Write a running report at docs/c910/c910_diff_report.md with an entry per iteration, and allow multiple phase notes per iteration/run. Each entry should include:

- Timestamp (YYYY-MM-DD HH:MM) and command used
- Log paths for ref and wolf
- Equivalence decision and evidence (key diff lines or summaries)
- Hypotheses for the next iteration
- Instrumentation changes (files, signals, guards)
- Results and next steps (include a phase label when the iteration has multiple stages)

Stop once equivalence is confirmed or the root cause is identified and documented. The final report must name the smallest suspected failing module and explicitly tell the user that convergence point.
