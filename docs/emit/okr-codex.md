# Emit 输出 OKR

> 每次开始工作前，回顾 docs/overview.md 和 docs/GRH-representation.md  
> 每次开始工作前，回顾前序阶段的完成情况（若有 docs/emit/phase*-report.md 则需阅读）  
> 本阶段目标：为 Emit 基类搭建可落地的框架，后续 JSON/Verilog 输出在此基础上派生

## 阶段1：搭建 Emit 类框架
- **目标定位** 搭建 `Emit` 抽象层，统一 GRH 到外部表示的输出入口，确保 JSON/Verilog 等具体实现只需继承并复用公共校验、诊断、输出流管理逻辑。
- **KR1 对齐：文件与构建骨架**
  - 新增 `include/emit.hpp`、`src/emit.cpp`，定义命名空间、前置声明、基础类型，确保编译目标被纳入现有 CMake/测试编译流程。
  - 约定对外接口（如 `Emit::emit(const grh::Netlist&, const EmitOptions&)`）在头文件声明、源文件提供最小默认实现或纯虚钩子，保证后续派生类落地时无需调整主入口。
  - 记录 TODO/设计假设（输出目录策略、日志接口对接位置）以便阶段评审。
- **KR2 对齐：基类职责与上下文设计**
  - 设计 `EmitOptions` / `EmitResult` / `EmitDiagnostics` 等轻量结构，覆盖输出路径、是否 pretty-print、目标顶层列表 override 等通用开关，并提供可扩展的 key-value 属性占位。
  - `Emit` 基类需包含：输入 `grh::Netlist` 的只读视图、诊断收集器、文件/流打开辅助函数、顶层存在性与端口合法性基础校验；对派生类暴露受保护的 `emitImpl` 纯虚接口。
  - 规划派生类的责任边界（JSON/Verilog 仅负责序列化逻辑，公用校验/资源管理留在基类），并在注释中固定期望的生命周期/线程安全假设。
- **KR3 对齐：测试/样例目录准备**
  - 创建 `tests/data/emit` 目录，准备最小可重用的 GRH Netlist JSON 或构造辅助（可先留空但添加 README 指明用途与格式约定）。
  - 创建 `tests/emit` 目录，规划单元测试用例：1）无顶层/空网表的错误路径；2）简单单模块网表的通过路径；3）诊断聚合与返回值的基类行为。必要时为后续派生类保留基类测试夹具。
  - 将测试骨架纳入 ctest（新增目标或占位测试文件），确保阶段收尾可运行并作为后续实现的回归入口。
- **验收口径**
  - CMake/编译配置中能找到新文件，编译通过且不破坏现有管线。
  - 头文件声明的入口和选项结构稳定清晰，具备可扩展性和最小诊断能力。
  - 测试目录与占位样例就绪，至少包含针对基类框架的空跑/失败路径测试计划或骨架。
