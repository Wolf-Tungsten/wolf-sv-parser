# CASE_007: SRAM Memory Initialization Bug

## Problem Description

wolf-sv-parser 生成的 SystemVerilog 代码中，SRAM 数组（`Memory`）缺少 `initial` 初始化块。这导致在仿真开始时，Memory 的内容是未定义的（X），而不是 RTL 中的随机初始化值。

## Root Cause

### RTL (Reference)

```verilog
// array_32x112.sv - from XiangShan RTL
reg [111:0] Memory[0:31];

`ifdef ENABLE_INITIAL_MEM_
  initial begin
    `INIT_RANDOM_PROLOG_
    `ifdef RANDOMIZE_MEM_INIT
      for (logic [5:0] i = 6'h0; i < 6'h20; i += 6'h1) begin
        for (logic [7:0] j = 8'h0; j < 8'h80; j += 8'h20) begin
          _RANDOM_MEM[j[6:0] +: 32] = `RANDOM;
        end
        Memory[i[4:0]] = _RANDOM_MEM[111:0];
      end
    `endif
    // ... register init
  end
`endif
```

### Wolf Emit

```verilog
// wolf_emit.sv - generated by wolf-sv-parser
reg [111:0] Memory [0:31];

// ONLY has always blocks for read/write
always @(posedge RW0_clk) begin
  if (__expr_3) begin
    Memory[RW0_addr][0] <= __expr_6[0];
    // ... bit-by-bit assignment
  end
end

// NO initial block for Memory initialization!
```

## Impact

This bug affects ABTB (Adaptive BTB) behavior:

| Metric | Ref | Wolf | Difference |
|--------|-----|------|------------|
| train_correct_target | 21 | 663 | 31.6x |
| total_write | 1506 | 2148 | 1.43x |

The uninitialized Memory causes:
1. Different hit patterns in ABTB lookup
2. Excessive training events
3. Divergent branch prediction behavior

## Testcase

This bugcase tests whether the Memory array is properly initialized.

### Files

- `rtl/sram_init_test.sv` - DUT with SRAM array
- `tb.v` - Testbench wrapper
- `tb.cpp` - C++ testbench comparing ref vs wolf
- `filelist.f` - File list for wolf-sv-parser
- `Makefile` - Build automation

### Running the Test

```bash
cd tests/data/xs-bugcase/CASE_007
make run
```

### Expected Results

**REF (with initialization):**
- Memory contains random but deterministic values
- `has_x` should be 0 for all addresses
- `is_zero` may be 0 or 1 depending on random values

**WOLF (without initialization - BUG):**
- Memory contains X (unknown)
- `has_x` will be non-zero for all addresses
- `is_zero` will be 0 (X != 0)

## Fix Direction

wolf-sv-parser should preserve or generate equivalent `initial begin` blocks for memory arrays:

```verilog
// Option 1: Preserve original initialization
initial begin
  for (integer i = 0; i < 32; i = i + 1)
    Memory[i] = $random(SEED);
end

// Option 2: Initialize to zero (deterministic)
initial begin
  for (integer i = 0; i < 32; i = i + 1)
    Memory[i] = 0;
end
```

## Related

- xs_bugcase_016.md - Previous ABTB-related divergence (root cause in FTQ)
- xs_wave_diff_20260217.md - Detailed waveform analysis
