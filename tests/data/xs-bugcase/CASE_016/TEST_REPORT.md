# CASE_016 Test Report

## Summary

**Status:** ✅ Bug successfully reproduced

**DUT:** `inner_ftq` (Ftq.sv)  
**Divergence Signal:** `io_fromBpu_prediction_ready`  
**Divergence Cycle:** 20 (corresponds to t=1154 in original waveform)

## Test Output

```
$ ./sim_CASE_016
[MISMATCH] cycle=20 io_fromBpu_prediction_ready ref=0 wolf=1
```

## Waveform Comparison

### Original XS Simulation (FST)
```
Time (ps)  | io_fromBpu_prediction_ready
-----------|---------------------------
0          | 1 (initial)
1154       | 0 ⬅️ Divergence point
1218       | 1
1240       | 0
...        | ...
```

### CASE_016 Bug Case
```
Cycle | io_fromBpu_prediction_ready
------|---------------------------
0-19  | 1 (initial/reset)
20    | ref=0, wolf=1 ⬅️ Divergence!
```

## Root Cause

The `io_fromBpu_prediction_ready` signal is generated by complex combinational logic in Ftq.sv:

```verilog
wire io_fromBpu_prediction_ready_0 =
  ~(~_io_fromBpu_prediction_ready_T & _io_fromBpu_prediction_ready_T_5[6])
  & (_io_fromBpu_prediction_ready_T_9
       ? _GEN_3
       : 7'(_io_fromBpu_prediction_ready_T_12 - _GEN_2)) < 7'h8 & ~(bpTrainStallCnt[3]);
```

**Wolf behavior:** Signal remains constant at 1 (no transitions)  
**Expected behavior:** Signal should transition to 0 at t=1154

## Input Stimulus

The testbench drives minimal inputs extracted from reference waveform:

| Cycle | Event |
|-------|-------|
| 3 | `io_fromBpu_prediction_valid = 1` |
| 4 | `io_fromBpu_meta_valid = 1` |
| 8 | `io_fromBpu_meta_valid = 0` |

Other inputs tied to sensible defaults.

## Build Instructions

```bash
cd tests/data/xs-bugcase/CASE_016

# Build reference (original RTL)
make build_ref

# Build wolf (wolf-sv-parser processed)
make build_wolf

# Run test
make run

# Or directly:
/workspace/wolf-sv-parser/build/xs_bugcase/CASE_016/sim_CASE_016
```

## Files

| File | Description |
|------|-------------|
| `rtl/Ftq.sv` | DUT (148,441 lines) |
| `rtl/ResolveQueue.sv` | Sub-module |
| `rtl/CommitQueue.sv` | Sub-module |
| `tb.v` | Testbench with trace replay |
| `tb.cpp` | C++ test framework |
| `events.json` | Extracted waveform events |
| `signals.txt` | 427 input signal names |

## Notes

1. This bug case successfully isolates the divergence to `inner_ftq`
2. CASE_014 (Bpu bugcase) could not reproduce because the bug is upstream in FTQ
3. The minimal input set is sufficient to trigger the divergence
4. Wolf-sv-parser warnings about initial assignments may be related to the bug

## Next Steps

For debugging wolf-sv-parser:
1. Compare GRH IR between ref and wolf for `io_fromBpu_prediction_ready` logic
2. Check if `bpTrainStallCnt` or other state variables are initialized correctly
3. Verify pointer arithmetic (`bpuPtr`, `commitPtr`, `ifuPtr`) in wolf output
